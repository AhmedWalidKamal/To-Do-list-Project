<!DOCTYPE html>
<html lang = "en">
<head>
    <title>ToDoList</title>
     <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
 
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="js/jquery.validate.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
 
    <!-- Using the coreect character set-->
    <meta charset="utf-8">
 
    <!--Mobile compatibility-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Adding datatables libraries -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>

    <!-- Incldung the css file -->
    <link rel="stylesheet" type="text/css" href="ProjectUbuntu.css">
    
<!-- jQuery Scriptting -->
<script>      
     
// Task class
function task(name, description, status, date)
{
  this.name = name;
  this.description = description;
  this.status = status;
  this.date = date;
}

/// Some global variables
var allTasksArr = [];
var currTasksArr = [];
var completedTasksArr = [];
var archivedTasksArr = [];
var value = 1;
var rowINDEX;
var myGlobalIndex;
var FnameAll = 1;
var FnameProg = 1;
var FnameComp = 1;
var FnameArchiv = 1;
var FdateAll = 1;
var FdateProg = 1;
var FdateComp = 1;
var FdateArchiv = 1;

 function SortByName1(a, b){
  var aName = a.name.toLowerCase();
  var bName = b.name.toLowerCase(); 
  return ((aName < bName) ? -1 : ((aName > bName) ? 1 : 0));
}
function SortByDate1(a,b){
  var aDate = new Date(a.date).getTime();
  var bDate = new Date(b.date).getTime();
  return ((aDate < bDate) ? -1 : ((aDate > bDate) ? 1 : 0));
}

function sortByname()
{
     $('#datatable thead').on('click','#SortByName',function()  ///this way sorts the arrays in ascending order
     {
      
        if (value==1) ///Ascending N Descending order
        {
          if (FnameAll==1){
          allTasksArr.sort(SortByName1);
          FnameAll*=-1;
          
          } 
          else if (FnameAll==-1)
          {
            allTasksArr.sort(SortByName1);
            allTasksArr.reverse();
            FnameAll*=-1;
            
          }
        }
        else if (value==2)
        {
          if (FnameProg==1){

          currTasksArr.sort(SortByName1);
          FnameProg*=-1;
          
          } 
          else if (FnameProg==-1)
          {
            currTasksArr.sort(SortByName1);
            currTasksArr.reverse();
            FnameProg*=-1;
            
          }
        }
        else if (value==3)
         {
          if (FnameComp==1){
          completedTasksArr.sort(SortByName1);
          FnameComp*=-1;
          
          }
          else if (FnameComp==-1){
            completedTasksArr.sort(SortByName1);
            completedTasksArr.reverse();
            FnameComp*=-1;
          
          }
        }
        else if (value==4)
        {
          if (FnameArchiv==1){
          archivedTasksArr.sort(SortByName1);
          FnameArchiv*=-1;
          
        }
        else if (FnameArchiv==-1){
            archivedTasksArr.sort(SortByName1);
            archivedTasksArr.reverse();
            FnameArchiv*=-1;
            
        }
      }
     
     });
}
function sortBydate()
{
     

    $('#datatable thead').on('click','#SortByDate',function()  ///this way sorts the arrays in ascending order
     {
      
        if (value==1) ///Ascending N Descending order
        {
          if (FdateAll==1){
          allTasksArr.sort(SortByDate1);
          FdateAll*=-1;
          
          } 
          else if (FdateAll==-1)
          {
            allTasksArr.sort(SortByDate1);
            allTasksArr.reverse();
            FdateAll*=-1;
            
          }
        }
        else if (value==2)
        {
          if (FdateProg==1){

          currTasksArr.sort(SortByDate1);
          FdateProg*=-1;
          
          } 
          else if (FdateProg==-1)
          {
            currTasksArr.sort(SortByDate1);
            currTasksArr.reverse();
            FdateProg*=-1;
            
          }
        }
        else if (value==3)
         {
          if (FdateComp==1){
          completedTasksArr.sort(SortByDate1);
          FdateComp*=-1;
          
          }
          else if (FdateComp==-1){
            completedTasksArr.sort(SortByDate1);
            completedTasksArr.reverse();
            FdateComp*=-1;
          
          }
        }
        else if (value==4)
        {
          if (FdateArchiv==1){
          archivedTasksArr.sort(SortByDate1);
          FdateArchiv*=-1;
          
        }
        else if (FnameArchiv==-1){
            archivedTasksArr.sort(SortByDate1);
            archivedTasksArr.reverse();
            FdateArchiv*=-1;
            
        }
      }
     
     });       
}

// Updating the sizes to be displayed in the left menu
function updateSize()
{
    $('#allsize').text(allTasksArr.length); 
    $('#currsize').text(currTasksArr.length);
    $('#completedsize').text(completedTasksArr.length);
    $('#archivedsize').text(archivedTasksArr.length);
}

// Deleting function
function deleteTask()
{        
        var table = $('#datatable').DataTable();   ///checking the index of the row in the datatable as well as that for the array  
        $('#datatable tbody').on( 'click', 'tr', function () {
              rowINDEX = table.row(this).index();
        }); 
        var table = $('#datatable').DataTable();
 
        $('#datatable').on( 'click', '#Delete', function () {
          var r = confirm("Are you sure you want to delete this task ?");
               if (r == true)
               {
                    if (value == 1)
                    {
                        var taskToMove = allTasksArr[rowINDEX];
                        if (allTasksArr[rowINDEX].status == 1)
                        {
                            var currentIndex = currTasksArr.indexOf(taskToMove);
                            currTasksArr.splice(currentIndex, 1);
                            allTasksArr.splice(rowINDEX, 1);
                            table
                            .row( $(this).parents('tr') )
                            .remove()
                            .draw(false);
                        }
                        else if (allTasksArr[rowINDEX].status == 0)
                        {
                            var completedIndex = completedTasksArr.indexOf(taskToMove);
                            completedTasksArr.splice(completedIndex, 1);
                            allTasksArr.splice(rowINDEX,1);
                            table
                            .row( $(this).parents('tr') )
                            .remove()
                            .draw(false);   
                        }
                    }
                    else if (value == 2)
                    {
                        var taskToMove = currTasksArr[rowINDEX];
                        var allIndex = allTasksArr.indexOf(taskToMove);
                        currTasksArr.splice(rowINDEX, 1);
                        allTasksArr.splice(allIndex, 1);
                        table
                        .row( $(this).parents('tr'))
                        .remove()
                        .draw(false);
                    }
                    else if (value == 3)
                    {
                        var taskToMove = completedTasksArr[rowINDEX];
                        var allIndex = allTasksArr.indexOf(taskToMove);
                        completedTasksArr.splice(rowINDEX, 1);
                        allTasksArr.splice(allIndex, 1);
                        table
                        .row( $(this).parents('tr') )
                        .remove()
                        .draw(false);
                        
                    }
                    else if (value == 4)
                    {
                      archivedTasksArr.splice(rowINDEX,1);
                      table
                        .row( $(this).parents('tr'))
                        .remove()
                        .draw(false);
                    }                
                }
                updateSize();        
        });
}

// Move tasks to completed area
function moveComplete()
{
    var table = $('#datatable').DataTable();   
    $('#datatable tbody').on( 'click', 'tr', function () {
          rowINDEX = table.row(this).index();
    }); 
    var table = $('#datatable').DataTable();

    $('#datatable').on('click', '#done', function (){
              var movableTask;
              if (value == 1)
              {
                  movableTask = allTasksArr[rowINDEX];
                  if (movableTask.status != 0 && movableTask.status != -1)
                  {
                      var currIndex = currTasksArr.indexOf(movableTask);
                      currTasksArr.splice(currIndex, 1);
                      allTasksArr[rowINDEX].status = 0;
                      completedTasksArr.push(movableTask);  
                      updateSize();          
                  }    
              }
              else if (value == 2)
              {
                  movableTask = currTasksArr[rowINDEX];
                  if (movableTask.status != 0 && movableTask.status != -1)
                  {
                      var allIndex = allTasksArr.indexOf(movableTask);
                      currTasksArr.splice(rowINDEX, 1);
                      allTasksArr[allIndex].status = 0;
                      completedTasksArr.push(movableTask);  
                      table.row( $(this).parents('tr')).remove().draw();
                      updateSize();
                  }
              }
    });  
}

function moveArchive()
{
    var table = $('#datatable').DataTable();   
    $('#datatable tbody').on( 'click', 'tr', function () {
          rowINDEX = table.row(this).index();
    }); 
    var table = $('#datatable').DataTable();

    $('#datatable').on('click', '#save', function (){
              var movableTask;
              if (value == 1)
              {
                  movableTask = allTasksArr[rowINDEX];
                  if (movableTask.status == 1)
                  {
                      var currIndex = currTasksArr.indexOf(movableTask);
                      currTasksArr.splice(currIndex, 1);
                      allTasksArr.splice(rowINDEX, 1);
                      archivedTasksArr.push(movableTask);
                      table.row( $(this).parents('tr')).remove().draw();
                      updateSize();
                  }
                  else if (movableTask.status == 0)
                  {
                      var completedIndex = completedTasksArr.indexOf(movableTask);
                      completedTasksArr.splice(completedIndex, 1);
                      allTasksArr.splice(rowINDEX, 1);
                      archivedTasksArr.push(movableTask);
                      table.row( $(this).parents('tr')).remove().draw();
                      updateSize();
                  }    
              }
              else if (value == 2)
              {
                  movableTask = currTasksArr[rowINDEX];
                  
                  var allIndex = allTasksArr.indexOf(movableTask);
                  currTasksArr.splice(rowINDEX, 1);
                  allTasksArr.splice(allIndex, 1);
                  archivedTasksArr.push(movableTask);  
                  table.row( $(this).parents('tr')).remove().draw();
                  updateSize();
                  
              }
              else if (value == 3)
              {
                  movableTask = completedTasksArr[rowINDEX];
                  var allIndex = allTasksArr.indexOf(movableTask);
                  allTasksArr.splice(allIndex, 1);
                  completedTasksArr.splice(rowINDEX, 1);
                  archivedTasksArr.push(movableTask);
                  table.row( $(this).parents('tr')).remove().draw();
                  updateSize();
              }
    }); 
}

function editTask()
{
    var table = $('#datatable').DataTable();   
    $('#datatable tbody').on( 'click', 'tr', function () {
        rowINDEX = table.row(this).index();
    }); 
    
    $('#datatable').on('click', '#Edit', function (){
              myGlobalIndex = rowINDEX;
              // Adding the data that was there to the modal
          
              $('#editName').val(currTasksArr[rowINDEX].name);
              $('#editDescrip').val(currTasksArr[rowINDEX].description);
              $('#editDate').val(currTasksArr[rowINDEX].date);
          
    });
}

// Drawing the table
function drawTable()
{
        /// Constructing the table layout             
        var concat = '<table id="datatable" class="table table-striped table-hover">';
        concat += '<thead>';
        concat += '<tr>';
        concat += '<th id="SortByName">Name</th>';
        concat += '<th>Description</th>';
        concat += '<th>Status</th>';
        concat += '<th id="SortByDate">Due Date</th>';
        concat += '<th>Options</th>';
        concat += '</tr>';
        concat += '</thead>';
        concat += '</table>';
        $('#here').html(concat);            
        $('#datatable').DataTable();  

        deleteTask();
        moveComplete();
        moveArchive();
        editTask();
        sortByname();
        sortBydate()
}

// Child row
function childRowMan()
{
      var table = $('#datatable').DataTable();
      $('#datatable').on('click', 'tr #childROW', function (){
          var tr = $(this).closest('tr');
          var row = table.row( tr );
             
          if (row.child.isShown()) 
          {
              // This row is already open - close it
              row.child.hide();
              tr.removeClass('shown');
          }
          else 
          {
              // Open this row
              if (value == 1)
              {
                  row.child(['<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">', allTasksArr[rowINDEX].description,'</table' ]).show();
                  tr.addClass('shown');
              }
              else if (value == 2)
              {
                  row.child(['<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">', currTasksArr[rowINDEX].description,'</table' ]).show();
                  tr.addClass('shown');
              }
              else if (value == 3)
              {
                  row.child(['<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">', completedTasksArr[rowINDEX].description,'</table' ]).show();
                  tr.addClass('shown');
              }
              else if (value == 4)
              {
                  row.child(['<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">', archivedTasksArr[rowINDEX].description,'</table' ]).show();
                  tr.addClass('shown');
              }            
          }
      });
}

$("ProjectPh1V1").ready(function(){
        drawTable();
        updateSize();  
        
        $('#555 > #all').on('click', function(){      
            $('#555 > #all').addClass('active');
            $('#555 > #inProg').removeClass('active');
            $('#555 > #compTasks').removeClass('active');
            $('#555 > #archiv').removeClass('active');
            value = 1;

            drawTable();   
                
            $("h3").text("All Tasks");

            for (i = 0; i <allTasksArr.length; i++){
                var newTask = new task(allTasksArr[i].name, allTasksArr[i].description, allTasksArr[i].status, allTasksArr[i].date);
                var currStatus;
                if (newTask.status == 1)
                    currStatus = "In Progress";
                else if (newTask.status == 0)
                    currStatus = "Completed";
                else
                    currStatus = "Archived";
                  
                $('#datatable').DataTable().row.add([newTask.name, '<td><td><button type="button" class="btn btn-default btn-sm"  id="childROW"> <span class="glyphicon glyphicon-plus-sign"></span> </button></td></td>', currStatus, newTask.date,'<button type="button" class="btn btn-default btn-sm" id="Delete"><span class="glyphicon glyphicon-trash"></span></button><button type="button" class="btn btn-default btn-sm" id="done"><span class="glyphicon glyphicon-ok"></span></button><button type="button" class="btn btn-default btn-sm" id="save"><span class="glyphicon glyphicon-folder-open"></span></button>' ]).draw();
            }
            updateSize();     
            childRowMan();
        });


        $('#555 > #inProg').on('click', function(){      
                  $('#555 > #inProg').addClass('active');
                  $('#555 > #all').removeClass('active');
                  $('#555 > #compTasks').removeClass('active');
                  $('#555 > #archiv').removeClass('active');
              
                  value = 2;  

                  drawTable();    
                
                  $("h3").text("In Progress");
          
                for (i = 0; i < currTasksArr.length; i++){
                  var newTask = new task(currTasksArr[i].name, currTasksArr[i].description, currTasksArr[i].status, currTasksArr[i].date);
                  var currStatus = "In Progress";
                      
                $('#datatable').DataTable().row.add([newTask.name, '<td><td><button type="button" class="btn btn-default btn-sm"  id="childROW"> <span class="glyphicon glyphicon-plus-sign"></span> </button></td></td>', currStatus, newTask.date,'<button type="button" class="btn btn-default btn-sm" id="Edit" data-toggle="modal" data-target="#editModal"><span class="glyphicon glyphicon-pencil"></span></button><button type="button" class="btn btn-default btn-sm" id="Delete"><span class="glyphicon glyphicon-trash"></span></button><button type="button" class="btn btn-default btn-sm" id="done"><span class="glyphicon glyphicon-ok"></span></button><button type="button" class="btn btn-default btn-sm" id="save"><span class="glyphicon glyphicon-folder-open"></span></button>']).draw();

                }
                updateSize(); 
                childRowMan();
                
        });

        $('#555 > #compTasks').on('click',function(){
            $('#555 > #compTasks').addClass('active');
            $('#555 > #all').removeClass('active');
            $('#555 > #inProg').removeClass('active');
            $('#555 > #archiv').removeClass('active');
              
            value = 3;

            drawTable();   
                
            $("h3").text("Completed Tasks");
      
            for (i = 0; i < completedTasksArr.length; i++){
              var newTask = new task(completedTasksArr[i].name, completedTasksArr[i].description, completedTasksArr[i].status, completedTasksArr[i].date);
              var currStatus = "Completed";
            $('#datatable').DataTable().row.add([newTask.name, '<td><td><button type="button" class="btn btn-default btn-sm"  id="childROW"> <span class="glyphicon glyphicon-plus-sign"></span> </button></td></td>', currStatus, newTask.date,'</button><button type="button" class="btn btn-default btn-sm" id="Delete"><span class="glyphicon glyphicon-trash"></span></button><button type="button" class="btn btn-default btn-sm" id="save"><span class="glyphicon glyphicon-folder-open"></span></button>' ]).draw();
            }
            updateSize();
            childRowMan();
      });

      $('#555 > #archiv').on('click',function(){
        $('#555 > #archiv').addClass('active');
        $('#555 > #all').removeClass('active');
        $('#555 > #inProg').removeClass('active');
        $('#555 > #compTasks').removeClass('active');
          
        value = 4;

        drawTable();    
            
        $("h3").text("Archived");

            for (i = 0; i < archivedTasksArr.length; i++){
              var newTask = new task(archivedTasksArr[i].name, archivedTasksArr[i].description, archivedTasksArr[i].status, archivedTasksArr[i].date);
              var currStatus = "Archived";
                  
             $('#datatable').DataTable().row.add([newTask.name, '<td><td><button type="button" class="btn btn-default btn-sm"  id="childROW"> <span class="glyphicon glyphicon-plus-sign"></span> </button></td></td>', currStatus, newTask.date,'<button type="button" class="btn btn-default btn-sm" id="Delete"><span class="glyphicon glyphicon-trash"></span></button>' ]).draw();

                    
            }
            updateSize();
            childRowMan();    
      });

      $('#editDate').datepicker();
      $('#datepicker').datepicker();
      $('#newTaskButton').click(function(){
         
          // Getting the values of the input
          var taskName = $('#focusedInput').val();
          var taskDescrip = $('#inputDefault').val();
          var taskDate = $('#datepicker').val();
          
          /// Here there should be the validations for the input by the user to ensure that he entered anything.
          if (taskName.length == 0)
          {
              // freezing the modal
              $('#newTaskButton').removeAttr("data-dismiss");

              // Displaying error message
              var conc = '<div class="alert alert-dismissible alert-danger" id="alertmessage">';
              conc += '<button type="button" class="close" data-dismiss="alert">';
              conc += '&times;';
              conc += '</button>';
              conc += 'Please enter a name for the task.';
              conc += '</div>';
              $('#alerterror').html(conc);
              
              // Closing the modal
                  $('#myModal').on('hidden.bs.modal', function () {
                    $(this).find("input,textarea,select").val('').end();
              });
          }
          else if (taskDescrip.length == 0)
          {
              // freezing the modal
              $('#newTaskButton').removeAttr("data-dismiss");

              // Displaying error message
              var conc = '<div class="alert alert-dismissible alert-danger" id="alertmessage">';
              conc += '<button type="button" class="close" data-dismiss="alert">';
              conc += '&times;';
              conc += '</button>';
              conc +='Please enter a description for the task';
              conc += '</div>';
              $('#alerterror').html(conc);
              
              // Closing the modal
                  $('#myModal').on('hidden.bs.modal', function () {
                    $(this).find("input,textarea,select").val('').end();
              });
          }
          else if (taskName.length > 50)
          {
              // freezing the modal
              $('#newTaskButton').removeAttr("data-dismiss");

              // Displaying error message
              var conc = '<div class="alert alert-dismissible alert-danger" id="alertmessage">';
              conc += '<button type="button" class="close" data-dismiss="alert">';
              conc += '&times;';
              conc += '</button>';
              conc += 'The task name can not be more than 50 characers.';
              conc += '</div>';
              $('#alerterror').html(conc);

              // Closing the modal
              $('#myModal').on('hidden.bs.modal', function () {
                    $(this).find("input,textarea,select").val('').end();
              });

          }
          else
          { 
                  // add dismiss attribute
                  $('#newTaskButton').attr("data-dismiss","modal");

                  // remove alert message
                  var rem = "";
                  $('#alerterror').html(rem);

                  // Creating and setting the new task and the arrays
                  var newTask = new task(taskName, taskDescrip, 1, taskDate);
                  allTasksArr.push(newTask);
                  currTasksArr.push(newTask);

                  // checking what the current value is
                  if (value == 1)
                  {
                      drawTable();    
                          
                      $("h3").text("All Tasks");

                      for (i = 0; i < allTasksArr.length; i++){
                          var newTask = new task(allTasksArr[i].name, allTasksArr[i].description, allTasksArr[i].status, allTasksArr[i].date);
                          var currStatus;
                          if (newTask.status == 1)
                              currStatus = "In Progress";
                          else if (newTask.status == 0)
                              currStatus = "Completed";
                          else
                              currStatus = "Archived";
                            
                         $('#datatable').DataTable().row.add([newTask.name, '<td><td><button type="button" class="btn btn-default btn-sm"  id="childROW"> <span class="glyphicon glyphicon-plus-sign"></span> </button></td></td>', currStatus, newTask.date,'<button type="button" class="btn btn-default btn-sm" id="Delete"><span class="glyphicon glyphicon-trash"></span></button><button type="button" class="btn btn-default btn-sm" id="done"><span class="glyphicon glyphicon-ok"></span></button><button type="button" class="btn btn-default btn-sm" id="save"><span class="glyphicon glyphicon-folder-open"></span></button>' ]).draw();
                            
                      }
                      updateSize();
                      childRowMan();
                  }
                  else if (value == 2)
                  {
                        drawTable();    
                            
                        $("h3").text("In Progress");
                      
                            for (i = 0; i < currTasksArr.length; i++){
                              var newTask = new task(currTasksArr[i].name, currTasksArr[i].description, currTasksArr[i].status, currTasksArr[i].date);
                              var currStatus = "In Progress";
                                  
                               $('#datatable').DataTable().row.add([newTask.name, '<td><td><button type="button" class="btn btn-default btn-sm"  id="childROW"> <span class="glyphicon glyphicon-plus-sign"></span> </button></td></td>', currStatus, newTask.date,'<button type="button" class="btn btn-default btn-sm" id="Edit" data-toggle="modal" data-target="#editModal"><span class="glyphicon glyphicon-pencil"></span></button><button type="button" class="btn btn-default btn-sm" id="Delete"><span class="glyphicon glyphicon-trash"></span></button><button type="button" class="btn btn-default btn-sm" id="done"><span class="glyphicon glyphicon-ok"></span></button><button type="button" class="btn btn-default btn-sm" id="save"><span class="glyphicon glyphicon-folder-open"></span></button>' ]).draw();
                            }
                            updateSize();
                            childRowMan();
                  }
                  else if (value == 3)
                  {
                      drawTable();    
                          
                      $("h3").text("Completed Tasks");
                    
                          for (i = 0; i < completedTasksArr.length; i++){
                            var newTask = new task(completedTasksArr[i].name, completedTasksArr[i].description, completedTasksArr[i].status, completedTasksArr[i].date);
                            var currStatus = "Completed";
                                
                          $('#datatable').DataTable().row.add([newTask.name, '<td><td><button type="button" class="btn btn-default btn-sm"  id="childROW"> <span class="glyphicon glyphicon-plus-sign"></span> </button></td></td>', currStatus, newTask.date,'</button><button type="button" class="btn btn-default btn-sm" id="Delete"><span class="glyphicon glyphicon-trash"></span></button><button type="button" class="btn btn-default btn-sm" id="save"><span class="glyphicon glyphicon-folder-open"></span></button>' ]).draw();
                          }

                          updateSize();
                          childRowMan();
                  }
                  else if (value == 4)
                  {
                      drawTable();  
                          
                      $("h3").text("Archived");

                          for (i = 0; i < archivedTasksArr.length; i++){
                            var newTask = new task(archivedTasksArr[i].name, archivedTasksArr[i].description, archivedTasksArr[i].status, archivedTasksArr[i].date);
                            var currStatus = "Archived";
                                
                          $('#datatable').DataTable().row.add([newTask.name, '<td><td><button type="button" class="btn btn-default btn-sm"  id="childROW"> <span class="glyphicon glyphicon-plus-sign"></span> </button></td></td>', currStatus, newTask.date,'<button type="button" class="btn btn-default btn-sm" id="Delete"><span class="glyphicon glyphicon-trash"></span></button>' ]).draw();

                          }
                          updateSize();
                          childRowMan();
                  }

                  // Closing the modal
                  $('#myModal').on('hidden.bs.modal', function () {
                    $(this).find("input,textarea,select").val('').end();
                  });
          }
      });

      $('#saveChanged').click(function(){
         
          // Getting the values of the input
          var taskName = $('#editName').val();
          var taskDescrip = $('#editDescrip').val();
          var taskDate = $('#editDate').val();
          
          /// Here there should be the validations for the input by the user to ensure that he entered anything.
          if (taskName.length == 0)
          {
              // freezing the modal
              $('#saveChanged').removeAttr("data-dismiss");

              // Displaying error message
              var conc = '<div class="alert alert-dismissible alert-danger" id="alertmessage">';
              conc += '<button type="button" class="close" data-dismiss="alert">';
              conc += '&times;';
              conc += '</button>';
              conc += 'Please enter a name for the task.';
              conc += '</div>';
              $('#editAlerterror').html(conc);
              
              // Closing the modal
                  $('#editModal').on('hidden.bs.modal', function () {
                    $(this).find("input,textarea,select").val('').end();
              });
          }
          else if (taskDescrip.length == 0)
          {
              // freezing the modal
              $('#saveChanged').removeAttr("data-dismiss");

              // Displaying error message
              var conc = '<div class="alert alert-dismissible alert-danger" id="alertmessage">';
              conc += '<button type="button" class="close" data-dismiss="alert">';
              conc += '&times;';
              conc += '</button>';
              conc +='Please enter a description for the task';
              conc += '</div>';
              $('#editAlerterror').html(conc);
              
              // Closing the modal
                  $('#editModal').on('hidden.bs.modal', function () {
                    $(this).find("input,textarea,select").val('').end();
              });
          }
          else if (taskName.length > 50)
          {
              // freezing the modal
              $('#saveChanged').removeAttr("data-dismiss");

              // Displaying error message
              var conc = '<div class="alert alert-dismissible alert-danger" id="alertmessage">';
              conc += '<button type="button" class="close" data-dismiss="alert">';
              conc += '&times;';
              conc += '</button>';
              conc += 'The task name can not be more than 50 characers.';
              conc += '</div>';
              $('#editAlerterror').html(conc);

              // Closing the modal
              $('#editModal').on('hidden.bs.modal', function () {
                    $(this).find("input,textarea,select").val('').end();
              });

          }
          else
          { 
                  // add dismiss attribute
                  $('#saveChanged').attr("data-dismiss","modal");

                  // remove alert message
                  var rem = "";
                  $('#editAlerterror').html(rem);

                  // Creating and setting the editted task and the arrays
                  var NEWTask = new task(taskName, taskDescrip, 1, taskDate);
                  var oldTask = currTasksArr[myGlobalIndex];
                  var alltasksarrayindex = allTasksArr.indexOf(oldTask);
                  allTasksArr[alltasksarrayindex] = NEWTask;
                  currTasksArr[myGlobalIndex] = NEWTask;
                  
                            drawTable();    
                            
                            for (i = 0; i < currTasksArr.length; i++){
                              var newTask = new task(currTasksArr[i].name, currTasksArr[i].description, currTasksArr[i].status, currTasksArr[i].date);
                              var currStatus = "In Progress";
                                  
                               $('#datatable').DataTable().row.add([newTask.name, '<td><td><button type="button" class="btn btn-default btn-sm"  id="childROW"> <span class="glyphicon glyphicon-plus-sign"></span> </button></td></td>', currStatus, newTask.date,'<button type="button" class="btn btn-default btn-sm" id="Edit" data-toggle="modal" data-target="#editModal"><span class="glyphicon glyphicon-pencil"></span></button><button type="button" class="btn btn-default btn-sm" id="Delete"><span class="glyphicon glyphicon-trash"></span></button><button type="button" class="btn btn-default btn-sm" id="done"><span class="glyphicon glyphicon-ok"></span></button><button type="button" class="btn btn-default btn-sm" id="save"><span class="glyphicon glyphicon-folder-open"></span></button>' ]).draw();
                            }

                            for (i = 0; i < allTasksArr.length; i++){
                                var newTask = new task(allTasksArr[i].name, allTasksArr[i].description, allTasksArr[i].status, allTasksArr[i].date);
                                var currStatus;
                                if (newTask.status == 1)
                                    currStatus = "In Progress";
                                else if (newTask.status == 0)
                                    currStatus = "Completed";
                                else
                                    currStatus = "Archived";
                            
                                $('#datatable').DataTable().row.add([newTask.name, '<td><td><button type="button" class="btn btn-default btn-sm" id="childROW"> <span class="glyphicon glyphicon-plus-sign"></span> </button></td></td>', currStatus, newTask.date,'<button type="button" class="btn btn-default btn-sm" id="Delete"><span class="glyphicon glyphicon-trash"></span></button><button type="button" class="btn btn-default btn-sm" id="done"><span class="glyphicon glyphicon-ok"></span></button><button type="button" class="btn btn-default btn-sm" id="save"><span class="glyphicon glyphicon-folder-open"></span></button>']);                            
                            }

                            
                            updateSize();
                            childRowMan();
                  
                  // Closing the modal
                  $('#editModal').on('hidden.bs.modal', function () {
                    $(this).find("input,textarea,select").val('').end();
                  });
          }
      });
});
</script>
</head>
 
<body>
 
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">TodoList</a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
         <!-- Here should be the name of the user -->
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"> <span class="glyphicon glyphicon-user"></span> Mohamed Tolba<span class="caret"></span> </a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="#">Settings</a></li> <!-- We can make an option to change the display name of the user -->
            <li><a href="homepage.html" id="logout">Logout</a></li>
          </ul>
      </li>
      </ul>
    </div>
  </div>
</nav>


<div class="container-fluid">
    <div class="row content">
        <div class="col-sm-2 sidenav" id="leftmenu">
            <ul class="nav nav-pills nav-stacked" id="555">
                 
                <li id="all" value=1 class="active"><a href="#section1">All Tasks<span class="badge" id="allsize"></span></a></li>
                <li id="inProg" value=2><a href="#section2" >In Progress<span class="badge" id="currsize"></span></a></li>
                <li id="compTasks" value=3><a href="#section3">Completed Tasks<span class="badge" id="completedsize"></span></a></li>
                <li id="archiv" value=4><a href="#section4">Archived<span class="badge" id="archivedsize"></a></li>
            </ul><br>
        </div>

        <div class="col-sm-10">
            <h3>All Tasks</h3>
            <hr>
            
            <!-- Creating the table here and adding elements to it whenever a new task is created. -->
            <p id="here"></p>
            
            <!-- Creating the add task button and the modal to be opened when it's clicked. -->
            <a href="#" class="btn btn-primary" id="addbutton" data-toggle="modal" data-target="#myModal"><span class="glyphicon glyphicon-plus"></span> Add Task</a><br>
            
            <!-- The modal for adding a new task -->
            <div class="modal" id="myModal">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <p id="alerterror"></p>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  </div>
                  <div class="modal-body">
                    <div class="form-group">
                      
                      <input class="form-control" id="focusedInput" type="text" placeholder="Task Name">
                    </div>
                    <div class="form-group">
                      
                      <input type="text" class="form-control" id="inputDefault" placeholder="Task Description">
                    </div>
                    <div class="form-group">         
                  <input type="text" class="form-control" id="datepicker" placeholder="Task due date(optional)">
                      
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button> 
                    <button type="button" class="btn btn-primary" id="newTaskButton">Add Task</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="modal" id="editModal">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <p id="editAlerterror"></p>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  </div>
                  <div class="modal-body">
                    <div class="form-group">
                      
                      <input class="form-control" id="editName" type="text">
                    </div>
                    <div class="form-group">
                      
                      <input type="text" class="form-control" id="editDescrip">
                    </div>
                    <div class="form-group">         
                  <input type="text" class="form-control" id="editDate">
                      
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button> 
                    <button type="button" class="btn btn-primary" id="saveChanged">Save changes</button>
                  </div>
                </div>
              </div>
            </div>
        
    </div>
  </div>
 
</body>
</html>